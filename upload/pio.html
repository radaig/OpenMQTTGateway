<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upload with PlatformIO | OpenMQTTGateway V1</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="icon" href="/img/Openmqttgateway_logo_mini.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="One gateway, many technologies: MQTT gateway for ESP8266, ESP32, Sonoff RF Bridge or Arduino with bidirectional 433mhz/315mhz/868mhz, Infrared communications, BLE, beacons detection, mi flora / mi jia / LYWSD02/ Mi Scale compatibility, SMS & LORA.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d55c9000.css" as="style"><link rel="preload" href="/assets/js/app.a0238183.js" as="script"><link rel="preload" href="/assets/js/2.fe34e03b.js" as="script"><link rel="preload" href="/assets/js/38.b9496a10.js" as="script"><link rel="prefetch" href="/assets/js/10.0232ce1d.js"><link rel="prefetch" href="/assets/js/11.9ebab4b7.js"><link rel="prefetch" href="/assets/js/12.35368dc4.js"><link rel="prefetch" href="/assets/js/13.93cb791f.js"><link rel="prefetch" href="/assets/js/14.7be7dba9.js"><link rel="prefetch" href="/assets/js/15.a0665b07.js"><link rel="prefetch" href="/assets/js/16.8aa222ea.js"><link rel="prefetch" href="/assets/js/17.e2f30d99.js"><link rel="prefetch" href="/assets/js/18.019570f2.js"><link rel="prefetch" href="/assets/js/19.989b7c13.js"><link rel="prefetch" href="/assets/js/20.a5e3f636.js"><link rel="prefetch" href="/assets/js/21.1fcd999d.js"><link rel="prefetch" href="/assets/js/22.890ded53.js"><link rel="prefetch" href="/assets/js/23.47e54f0e.js"><link rel="prefetch" href="/assets/js/24.c9515116.js"><link rel="prefetch" href="/assets/js/25.3a306da5.js"><link rel="prefetch" href="/assets/js/26.b94cc35f.js"><link rel="prefetch" href="/assets/js/27.ae5514a1.js"><link rel="prefetch" href="/assets/js/28.af72a617.js"><link rel="prefetch" href="/assets/js/29.162c0949.js"><link rel="prefetch" href="/assets/js/3.f1b8e57f.js"><link rel="prefetch" href="/assets/js/30.6aad12fb.js"><link rel="prefetch" href="/assets/js/31.92ecca39.js"><link rel="prefetch" href="/assets/js/32.d4c5724f.js"><link rel="prefetch" href="/assets/js/33.2a4cab7c.js"><link rel="prefetch" href="/assets/js/34.36841bb0.js"><link rel="prefetch" href="/assets/js/35.6889d806.js"><link rel="prefetch" href="/assets/js/36.c2603237.js"><link rel="prefetch" href="/assets/js/37.7df7ad7e.js"><link rel="prefetch" href="/assets/js/39.20cf1d73.js"><link rel="prefetch" href="/assets/js/4.99076729.js"><link rel="prefetch" href="/assets/js/40.65a31dcc.js"><link rel="prefetch" href="/assets/js/41.db074ad3.js"><link rel="prefetch" href="/assets/js/42.3f3bc55d.js"><link rel="prefetch" href="/assets/js/43.7805fcad.js"><link rel="prefetch" href="/assets/js/44.d491e85a.js"><link rel="prefetch" href="/assets/js/45.70f3403f.js"><link rel="prefetch" href="/assets/js/5.82a27a7a.js"><link rel="prefetch" href="/assets/js/6.88880e3d.js"><link rel="prefetch" href="/assets/js/7.b965044b.js"><link rel="prefetch" href="/assets/js/8.e8ccb9c7.js"><link rel="prefetch" href="/assets/js/9.2c6f2bb6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d55c9000.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OpenMQTTGateway V1</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Devices
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/boards" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Boards
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for 🏠</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisites🧭</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2 - Set it up 🔨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3 - Upload ➡️</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/upload/binaries.html" class="sidebar-link">Upload Binaries</a></li><li><a href="/upload/pio.html" aria-current="page" class="active sidebar-link">Upload with PlatformIO</a></li><li><a href="/upload/arduino-ide.html" class="sidebar-link">Upload with Arduino IDE</a></li><li><a href="/upload/portal.html" class="sidebar-link">Wifi and MQTT configuration</a></li><li><a href="/upload/advanced-configuration.html" class="sidebar-link">Advanced configuration of the gateway</a></li><li><a href="/upload/troubleshoot.html" class="sidebar-link">Troubleshooting</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4 - Use ✈️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5 - Integrate 🎉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6 - Participate 💻</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="upload-with-platformio"><a href="#upload-with-platformio" class="header-anchor">#</a> Upload with PlatformIO</h1> <p>This section is usefull if you want to do advanced configuration of your project or if you choose an Arduino. Indeed the ESP family can be loaded directly without any configuration from your desktop.
Advanced configurations means changing the default used pins, the MQTT subjects and all the expert parameters that you can find in <a href="https://github.com/1technophile/OpenMQTTGateway/blob/development/main/User_config.h" target="_blank" rel="noopener noreferrer">User_config.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and in all <a href="https://github.com/1technophile/OpenMQTTGateway/tree/development/main" target="_blank" rel="noopener noreferrer">config_XX.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
If you don't have to change the default parameters except wifi and broker setting you can go directly to the <a href="load">Load</a> section.</p> <p>Download the <a href="https://github.com/1technophile/OpenMQTTGateway/releases" target="_blank" rel="noopener noreferrer">CODE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from github.</p> <p>So as to configure OpenMQTTGateway you have the choice between 2 development environments:</p> <ul><li><a href="https://www.arduino.cc/en/Main/Software" target="_blank" rel="noopener noreferrer">Arduino IDE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://platformio.org/" target="_blank" rel="noopener noreferrer">PlatformIO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>I advise to use PlatformIO, this way you will not have to search for all the necessary libraries and adequate forks/revisions. If you really want to use Arduino you need to download the libraries listed <a href="https://github.com/1technophile/OpenMQTTGateway/blob/d2dd6138558909b71cc44f69665340247bd5f356/platformio.ini#L55" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> at the version or revision specified.</p> <p>With PlatformIO</p> <ul><li>Open the folder named &quot;OpenMQTTGateway&quot;</li> <li>Open the platformio.ini file and uncomment the default_envs line corresponding to your board and choosen module like below.</li></ul> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token comment">;default_envs = sonoff-basic-rfr3</span>
<span class="token comment">;default_envs = rfbridge</span>
<span class="token comment">;default_envs = esp32dev-all</span>
<span class="token constant">default_envs</span> <span class="token attr-value"><span class="token punctuation">=</span> esp32dev-rf</span>
<span class="token comment">;default_envs = esp32dev-ir</span>
<span class="token comment">;default_envs = esp32dev-ble</span>
<span class="token comment">;default_envs = ttgo-lora32-v1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If you don't know which <code>env</code> to activate you can refer to <a href="../prerequisites/devices">devices</a>.</p> <p>The different listed configurations represents some standard environments and boards, to overload them with special parameters or modules you can modify the config files (<a href="https://github.com/1technophile/OpenMQTTGateway/blob/development/main/config_RF.h" target="_blank" rel="noopener noreferrer">config_RF.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for example). The definitions coming from <a href="https://github.com/1technophile/OpenMQTTGateway/blob/development/platformio.ini" target="_blank" rel="noopener noreferrer">platformio.ini<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> file and config files are cumulative.
The main config file is <a href="https://github.com/1technophile/OpenMQTTGateway/blob/development/main/User_config.h" target="_blank" rel="noopener noreferrer">User_config.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, added to it you have one config file per gateway, sensor or actuator, you will find them in the <a href="https://github.com/1technophile/OpenMQTTGateway/tree/development/main" target="_blank" rel="noopener noreferrer">main<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> folder.</p> <p>If you want to add more sensors or gateways to one <code>default_envs</code> you can add the modules directly into your environment definition of your .ini files or uncomment them into <a href="https://github.com/1technophile/OpenMQTTGateway/blob/d2dd6138558909b71cc44f69665340247bd5f356/main/User_config.h#L84" target="_blank" rel="noopener noreferrer">User_config.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Example to add IR to <code>esp32dev-rf</code> add the <code>build_flags</code> below to the env definition:</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token constant">  '-DZgatewayIR</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;IR&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token selector">[env:esp32dev-rf]</span>
<span class="token constant">platform</span> <span class="token attr-value"><span class="token punctuation">=</span> ${com.esp32_platform}</span>
<span class="token constant">board</span> <span class="token attr-value"><span class="token punctuation">=</span> esp32dev</span>
<span class="token constant">lib_deps</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
  ${com-esp.lib_deps}
  ${libraries.rc-switch}
<span class="token constant">build_flags</span> <span class="token attr-value"><span class="token punctuation">=</span> </span>
  ${com-esp.build_flags}
<span class="token constant">  '-DZgatewayRF</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;RF&quot;'</span>
<span class="token constant">  '-DZgatewayIR</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;IR&quot;'</span>
<span class="token constant">  '-DGateway_Name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;OpenMQTTGateway_ESP32_RF_IR&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>You can define your environment into an additionnal <code>production_env.ini</code> file than <code>platformio.ini</code>, when building PIO will scan for all the</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>*_env.ini
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This way when updating the code your environments definition will not be overwritten.</p> <p>Once your configuration is done you can upload the program to your board by clicking on the white arrow at the blue bottom bar of your PIO editor or with the following command:
<code>pio run --target upload</code></p> <p>PIO will download the necessaries platform and libraries with the correct versions, build the code and upload it.</p> <p>If you encounter errors the first thing to do is to clean your environment by using the white dust bin in the blue bottom bar.</p> <p>With some ESP it could be necessary to push the reset button when the upload begin.</p> <p>If you want to erase the settings stored in the ESP memory use:
<code>pio run --target erase</code>
This can be usefull especialy before the first upload or when you change the board partitions sizing.</p> <p>Once done the gateway should connect to your network and your broker, you should see it into the broker in the form of the following messages:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/LWT Online 
home/OpenMQTTGateway/version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="ota"><a href="#ota" class="header-anchor">#</a> OTA</h1> <p>With PIO you can also upload the firmware through Over the Air, so as to do that you can add the upload options flags used below, <code>upload_port</code> is the IP adress of your ESP:</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token selector">[env:esp32-ble]</span>
<span class="token constant">platform</span> <span class="token attr-value"><span class="token punctuation">=</span> ${com.esp32_platform}</span>
<span class="token constant">board</span> <span class="token attr-value"><span class="token punctuation">=</span> esp32dev</span>
<span class="token constant">board_build.partitions</span> <span class="token attr-value"><span class="token punctuation">=</span> min_spiffs.csv</span>
<span class="token constant">lib_deps</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
  ${com-esp.lib_deps}
  ${libraries.ble}
<span class="token constant">build_flags</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
  ${com-esp.build_flags}
<span class="token constant">  '-DZgatewayBT</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;BT&quot;'</span>
<span class="token constant">  '-DGateway_Name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;OpenMQTTGateway_ESP32&quot;'</span>
<span class="token constant">upload_protocol</span> <span class="token attr-value"><span class="token punctuation">=</span> espota</span>
<span class="token constant">upload_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 192.168.1.22</span>
<span class="token constant">upload_flags</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">  --auth</span><span class="token attr-value"><span class="token punctuation">=</span>OTAPASSWORD</span>
<span class="token constant">  --port</span><span class="token attr-value"><span class="token punctuation">=</span>8266</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h1 id="api"><a href="#api" class="header-anchor">#</a> API</h1> <p>With the V0.9 we added the support of json for receiving and publishing.
Per default Json reception and Json publication is activated, the previous simple reception mode is also activated to avoid regression on commands.</p> <p>You can deactivate Json or simple mode following theses instructions:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">jsonPublishing <span class="token boolean">true</span> </span><span class="token comment">//comment if you don't want to use Json  publishing  (one topic for all the parameters)</span></span>
<span class="token comment">//example home/OpenMQTTGateway_ESP32_DEVKIT/BTtoMQTT/4XXXXXXXXXX4 {&quot;rssi&quot;:-63,&quot;servicedata&quot;:&quot;fe0000000000000000000000000000000000000000&quot;}</span>
<span class="token comment">//#define simplePublishing true //comment if you don't want to use simple publishing (one topic for one parameter)</span>
<span class="token comment">//example </span>
<span class="token comment">// home/OpenMQTTGateway_ESP32_DEVKIT/BTtoMQTT/4XXXXXXXXXX4/rssi -63.0</span>
<span class="token comment">// home/OpenMQTTGateway_ESP32_DEVKIT/BTtoMQTT/4XXXXXXXXXX4/servicedata fe0000000000000000000000000000000000000000</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">simpleReceiving <span class="token boolean">true</span> </span><span class="token comment">//comment if you don't want to use old way reception analysis</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">jsonReceiving <span class="token boolean">true</span> </span><span class="token comment">//comment if you don't want to use Json  reception analysis</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>If you are using platformio you can also comment the definitions above and define your parameters into platformio.ini file by setting the following <code>build_flags</code>:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>  <span class="token string">'-DjsonPublishing=true'</span>
  <span class="token string">'-DjsonReceiving=true'</span>
  <span class="token string">'-DsimpleReceiving=true'</span>
  <span class="token string">'-DsimplePublishing=true'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Note that depending on the environment the default platformio.ini has common option defined see sections:</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token selector">[com-arduino]</span>
<span class="token selector">[com-esp]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>If you want to use HASS MQTT discovery you need to have
<code>#define jsonPublishing true</code>
&amp;
<code>#define ZmqttDiscovery &quot;HADiscovery&quot;</code>
uncommented.
Added to that auto discovery box should be selected into your Home Assistant MQTT integration configuration.</p> <p>With an ESP if you did not set your network and mqtt parameters manualy you can now open the <a href="/upload/portal.html">web portal configuration</a>.</p> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>simpleReceiving on Arduino boards doesn't accept 64 bits MQTT values, you can only send 32bits values from the MQTT broker.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/1technophile/OpenMQTTGateway/edit/development/docs/upload/pio.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/25/2021, 12:54:08 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/upload/binaries.html" class="prev">
        Upload Binaries
      </a></span> <span class="next"><a href="/upload/arduino-ide.html">
        Upload with Arduino IDE
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0238183.js" defer></script><script src="/assets/js/2.fe34e03b.js" defer></script><script src="/assets/js/38.b9496a10.js" defer></script>
  </body>
</html>
